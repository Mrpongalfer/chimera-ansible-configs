# Default prometheus.yml.j2 generated by Chimera v2.7
# Includes scraping Prometheus itself and Node Exporters on server/client groups

global:
  scrape_interval: 15s # Default scrape interval
  evaluation_interval: 15s # Default evaluation interval

# Alertmanager configuration (Add later if needed)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets: ['alertmanager:9093'] # Example

# Load rule files from directory (Add later if needed)
# rule_files:
#   - "/etc/prometheus/rules/*.rules.yml"

scrape_configs:
  - job_name: "prometheus"
    # Scrape Prometheus itself (inside Docker, use service name & container port)
    static_configs:
      - targets: ["localhost:{{ prometheus_port | default(9091) }}"]

  - job_name: "node_exporter"
    # Scrape node_exporter on server and clients using inventory groups
    static_configs:
      # --- Targets for Server Group ---
      - targets:
{% for host in groups['server'] %}
          - "{{ hostvars[host]['ansible_host'] | default(host) }}:{{ node_exporter_port | default(9100) }}"
{% endfor %}
        labels:
          group: 'server'

      # --- Targets for Clients Group ---
      - targets:
{% for host in groups['clients'] %}
          - "{{ hostvars[host]['ansible_host'] | default(host) }}:{{ node_exporter_port | default(9100) }}"
{% endfor %}
        labels:
          group: 'clients'

# Add other scrape configs here (e.g., for specific applications)

