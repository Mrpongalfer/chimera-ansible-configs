# Default prometheus.yml.j2 created by Chimera v2.7
# Review and customize scrape configs as needed via Git.
global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  - job_name: "prometheus"
    # Scrape Prometheus itself
    static_configs:
      - targets: ["localhost:{{ prometheus_port | default(9091) }}"]

  - job_name: "node_exporter"
    # Scrape node_exporter on server and clients
    static_configs:
      - targets:
        # Use inventory_hostname accesses the specific host from the loop/play context
        # Assuming node exporter runs on default port 9100 on all hosts in 'all' group
        {% for host in groups['all'] %}
          # Use hostvars to get the ansible_host (IP) if defined, else use inventory_hostname
          - "{{ hostvars[host]['ansible_host'] | default(host) }}:{{ node_exporter_port | default(9100) }}"
        {% endfor %}
    # Example using host groups (if defined in inventory)
    # static_configs:
    #  - targets: # Servers
    #    {% for host in groups['server'] %}
    #      - "{{ hostvars[host]['ansible_host'] | default(host) }}:{{ node_exporter_port | default(9100) }}"
    #    {% endfor %}
    #  - targets: # Clients
    #    {% for host in groups['clients'] %}
    #      - "{{ hostvars[host]['ansible_host'] | default(host) }}:{{ node_exporter_port | default(9100) }}"
    #    {% endfor %}

# Add alerting rules configuration if needed
# rule_files:
#   - "/etc/prometheus/alert.rules.yml"

# Add remote write configuration if needed
# remote_write:
#   - url: "http://remote-storage:port/api/v1/write"
