# Default functional docker-compose.yml.j2 generated by Chimera v2.7 v1.4
# Runs container as 'nobody' user. Ensures volume permissions.

services: # Removed obsolete version key
  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    user: "nobody:nogroup" # Standard non-root user:group often available in images
    volumes:
      # Mount config file rendered by Ansible (read-only)
      - {{ prometheus_config_file_path }}:/etc/prometheus/prometheus.yml:ro
      # Mount data volume - HOST PATH MUST BE WRITABLE BY nobody:nogroup (UID/GID 65534)
      - {{ prometheus_data_dir }}:/prometheus
    ports:
      # Use variable from play vars (site.yml) for host port
      - "{{ prometheus_port }}:9090"
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--web.console.libraries=/usr/share/prometheus/console_libraries'
      - '--web.console.templates=/usr/share/prometheus/consoles'
      - '--web.enable-lifecycle'
    restart: unless-stopped
    # networks:
    #  - monitoring_network

# networks:
#   monitoring_network:
#     external: true
