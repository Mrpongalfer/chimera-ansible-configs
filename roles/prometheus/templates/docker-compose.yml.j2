# Default docker-compose.yml.j2 created by Chimera v2.7
# Review and adapt for your environment via Git.

version: '3.7'

services:
  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    volumes:
      # Mount config file rendered by Ansible
      - {{ prometheus_config_file_path }}:/etc/prometheus/prometheus.yml:ro
      # Mount data volume (ensure host path exists and has correct owner/group for container user)
      - {{ prometheus_data_dir }}:/prometheus
    ports:
      - "{{ prometheus_port | default(9090) }}:9090"
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--web.console.libraries=/usr/share/prometheus/console_libraries'
      - '--web.console.templates=/usr/share/prometheus/consoles'
      - '--web.enable-lifecycle' # Allows hot-reloading config via API
    restart: unless-stopped
    # user: "nobody:nobody" # Recommend using non-root user after volume permissions set correctly
    # Add networks if needed
    # networks:
    #  - monitoring_network

# Define networks if needed
# networks:
#   monitoring_network:
#     external: true # Or define it here

